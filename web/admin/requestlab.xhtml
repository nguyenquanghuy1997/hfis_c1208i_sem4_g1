<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <body>

        <ui:composition template="./../controlpanel_template.xhtml">

            <ui:define name="head">
                <h:outputScript name="/js/metro/metro-calendar.js" />
                <h:outputScript name="/js/metro/metro-datepicker.js" />
                <h:outputScript name="/js/metro/metro-scroll.js" />
                <h:outputScript name="/js/metro/metro-hint.js" />
            </ui:define>

            <ui:define name="content">
                <div id="calendar" class="calendar"></div>
                <!--                <h:form id="hiddenForm">
                                    
                                </h:form>-->
                <h:form id="mainForm">
                    <h:inputHidden id="date" value="#{labScheduleUI.date}" />
                    <script>
                        $(".calendar").calendar({
                            format: 'dd/mm/yyyy', //default 'yyyy-mm-dd'
                            multiSelect: true, //default true (multi select date)
                            startMode: 'day', //year, month, day
                            otherDays: false, // show days for previous and next months,
                            weekStart: 1, //start week from sunday - 0 or monday - 1
                            getDates: function(data) {
                                var r = "";
                                $.each(data, function(i, d) {
                                    r += d + ",";
                                });
                                //                            out.html(r);
                                document.getElementById("mainForm:date").value = r;
                                //                            $("#hiddenForm:date").val(r);
                            },
                            click: function(d) {
                                //                            $("#calendar-output2").val(d);
                                //                            $("hiddenForm:date").val(d);
                                //                            $("#btnSend").click();
                            }
                        });
                    </script>
                    <h:selectOneMenu value="#{labScheduleUI.slot}">
                        <f:selectItems value="#{labScheduleUI.slots}" var="slot" itemValue="#{slot}" itemLabel="Slot #{slot} (#{slotUI.getDisplaySlot(slot)})" />
                    </h:selectOneMenu>
                    <h:commandButton action="#{labScheduleUI.checkLab()}" value="Check Schedule">
                        <f:ajax execute="@form" render=":mainForm:preparationDetail"/>
                    </h:commandButton>
                    <h:panelGroup id="preparationDetail">
                        <h:panelGroup rendered="#{labScheduleUI.addPreparation!=null}">
                            <ul>
                                <ui:repeat value="#{labScheduleUI.addPreparation}" var="ls">
                                    <h:outputLabel rendered="#{ls.labId!=null}">
                                        <li>Date: #{ls.displayDate} Slot: #{ls.slot} Lab: #{ls.labId.name}</li>
                                    </h:outputLabel>
                                    <h:outputLabel rendered="#{ls.labId==null}">
                                        <li class="fg-red">Date: #{ls.displayDate} Slot: #{ls.slot} No lab available (this entry won't be include to the request)</li>
                                    </h:outputLabel>
                                </ui:repeat>
                            </ul>
                            <h:commandButton action="#{labScheduleUI.requestLab()}" value='Confirm'></h:commandButton>
                        </h:panelGroup>
                    </h:panelGroup>
                </h:form>
            </ui:define>

        </ui:composition>

    </body>
</html>
